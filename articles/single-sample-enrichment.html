<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Single-sample enrichment with ssTaxSEA • TaxSEA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Single-sample enrichment with ssTaxSEA">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TaxSEA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-guides">
<li><a class="dropdown-item" href="../articles/why-taxon-set-enrichment.html">Why use taxon set enrichment?</a></li>
    <li><a class="dropdown-item" href="../articles/FAQs.html">FAQs</a></li>
    <li><a class="dropdown-item" href="../articles/Taxonomic-aggregation.html">Taxonomic aggregation</a></li>
    <li><a class="dropdown-item" href="../articles/TaxSEA.html">Using TaxSEA</a></li>
    <li><a class="dropdown-item" href="../articles/ORA_vs_ES.html">Analysis types</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/feargalr/taxsea/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Single-sample enrichment with ssTaxSEA</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/feargalr/taxsea/blob/main/vignettes/single-sample-enrichment.Rmd" class="external-link"><code>vignettes/single-sample-enrichment.Rmd</code></a></small>
      <div class="d-none name"><code>single-sample-enrichment.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="why-per-person-enrichment">Why per-person enrichment?<a class="anchor" aria-label="anchor" href="#why-per-person-enrichment"></a>
</h2>
<p>Standard TaxSEA works at the group level. You run a differential
abundance analysis, get a fold change for each taxon, and ask whether
biologically related taxa shift together. That’s powerful for
characterising what differs between groups.</p>
<p>But sometimes the more interesting question is about individuals:</p>
<ul>
<li>Which patients in my IBD cohort show an oral bacteria
signature?</li>
<li>Does this person’s microbiome look more “disease-like” or
“health-like” for a particular trait?</li>
<li>Can I stratify my cohort by enrichment patterns rather than by
diagnosis alone?</li>
</ul>
<p>Group-level enrichment can’t answer these questions because it
collapses all individuals into a single summary statistic.
<code>ssTaxSEA</code> extends TaxSEA to produce an enrichment score for
every sample, for every taxon set.</p>
</div>
<div class="section level2">
<h2 id="how-it-works">How it works<a class="anchor" aria-label="anchor" href="#how-it-works"></a>
</h2>
<p>The core idea is borrowed from single-sample Gene Set Enrichment
Analysis (ssGSEA), adapted for microbiome count data.</p>
<p>The approach has four steps:</p>
<ol style="list-style-type: decimal">
<li><p><strong>CLR transform.</strong> Raw counts are transformed using
the centered log-ratio, which accounts for the compositional nature of
microbiome data. Zeros are replaced with a small pseudocount (0.5)
before transformation.</p></li>
<li><p><strong>Z-score each taxon across the cohort.</strong> After CLR
transformation, each taxon is z-scored across all samples. This is the
critical step. It means that values no longer reflect within-sample
abundance, but instead reflect how much higher or lower a taxon is in a
given sample <em>relative to the cohort mean</em>. Without this step,
you would only be asking “are these taxa the most abundant in this
person?” rather than “does this person have unusually high levels of
these taxa compared to everyone else?”.</p></li>
<li><p><strong>Rank and score.</strong> For each sample, the z-scores
are ranked and an ssGSEA-style weighted running-sum enrichment score is
computed for each taxon set.</p></li>
<li><p><strong>KS test.</strong> A Kolmogorov-Smirnov p-value is
computed per sample per set, testing whether the set members are shifted
relative to all taxa in that sample.</p></li>
</ol>
<p>The output is a matrix of enrichment scores (samples x taxon sets)
and a corresponding matrix of p-values.</p>
</div>
<div class="section level2">
<h2 id="why-z-scoring-matters">Why z-scoring matters<a class="anchor" aria-label="anchor" href="#why-z-scoring-matters"></a>
</h2>
<p>This is worth emphasising because it’s the key difference between a
naive per-sample approach and one that actually works.</p>
<p>Consider oral bacteria in an IBD cohort. At the group level, these
taxa are consistently elevated in IBD relative to healthy controls, and
TaxSEA picks this up easily from fold changes. But in any individual
sample, oral bacteria are unlikely to be the <em>most abundant</em>
taxa. They might sit at moderate abundance in IBD samples and low
abundance in controls.</p>
<p>If you simply rank each sample’s taxa by their own abundance and run
enrichment, oral bacteria won’t stand out in either group because both
groups have the same dominant gut commensals. The within-sample ranking
buries the between-group signal.</p>
<p>Z-scoring across the cohort solves this. A taxon gets a high z-score
in a sample only if that sample has more of it than average. So in IBD
samples, oral bacteria will have positive z-scores (elevated relative to
the cohort), and in healthy samples, they will have negative z-scores.
The enrichment test then picks up exactly the pattern you expect.</p>
</div>
<div class="section level2">
<h2 id="when-to-use-sstaxsea-vs-taxsea">When to use ssTaxSEA vs TaxSEA<a class="anchor" aria-label="anchor" href="#when-to-use-sstaxsea-vs-taxsea"></a>
</h2>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th></th>
<th><strong>TaxSEA</strong></th>
<th><strong>ssTaxSEA</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Input</strong></td>
<td>Named vector of fold changes or correlations</td>
<td>Count matrix (taxa x samples) or TreeSummarizedExperiment</td>
</tr>
<tr class="even">
<td><strong>Output</strong></td>
<td>One enrichment result per taxon set</td>
<td>One enrichment score per sample per taxon set</td>
</tr>
<tr class="odd">
<td><strong>Question</strong></td>
<td>What trait-based shifts characterise the difference between
groups?</td>
<td>Which individual samples show a given enrichment pattern?</td>
</tr>
<tr class="even">
<td><strong>Use case</strong></td>
<td>Interpreting DA results, contextualising group differences</td>
<td>Patient stratification, individual-level phenotyping, heterogeneity
analysis</td>
</tr>
</tbody>
</table>
<p>In practice, you might use both: run TaxSEA first to identify which
taxon sets are enriched at the group level, then use ssTaxSEA to see how
those enrichments distribute across individuals.</p>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<div class="section level3">
<h3 id="from-a-count-matrix">From a count matrix<a class="anchor" aria-label="anchor" href="#from-a-count-matrix"></a>
</h3>
<p>The input should be a matrix with taxa as rows and samples as
columns. Row names must be taxon names (species or genus) in the same
format as standard TaxSEA.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/feargalr/taxsea" class="external-link">TaxSEA</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># counts: taxa (rows) x samples (columns)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssTaxSEA.html">ssTaxSEA</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Enrichment scores: samples x taxon sets</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">scores</span><span class="op">)</span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">scores</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># P-values: samples x taxon sets</span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">pvalues</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="from-a-treesummarizedexperiment">From a TreeSummarizedExperiment<a class="anchor" aria-label="anchor" href="#from-a-treesummarizedexperiment"></a>
</h3>
<p><code>ssTaxSEA</code> accepts TSE objects directly. It will extract
the count assay and use <code><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames()</a></code> as taxon
identifiers.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://microbiome.github.io/mia/" class="external-link">mia</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/feargalr/taxsea" class="external-link">TaxSEA</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">GlobalPatterns</span>, package <span class="op">=</span> <span class="st">"mia"</span><span class="op">)</span></span>
<span><span class="va">tse</span> <span class="op">&lt;-</span> <span class="va">GlobalPatterns</span></span>
<span></span>
<span><span class="co"># Subset to two sample types</span></span>
<span><span class="va">tse</span> <span class="op">&lt;-</span> <span class="va">tse</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">tse</span><span class="op">)</span><span class="op">$</span><span class="va">SampleType</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Feces"</span>, <span class="st">"Soil"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">tse</span> <span class="op">&lt;-</span> <span class="va">tse</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">tse</span>, <span class="st">"counts"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssTaxSEA.html">ssTaxSEA</a></span><span class="op">(</span><span class="va">tse</span>, min_set_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">scores</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="with-custom-taxon-sets">With custom taxon sets<a class="anchor" aria-label="anchor" href="#with-custom-taxon-sets"></a>
</h3>
<p>As with standard TaxSEA, you can provide your own taxon sets. When
using a custom database, names in the sets should match your row names
directly (no NCBI ID conversion is performed).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_sets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  oral_taxa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Fusobacterium_nucleatum"</span>, <span class="st">"Streptococcus_mutans"</span>,</span>
<span>                <span class="st">"Porphyromonas_gingivalis"</span>, <span class="st">"Prevotella_intermedia"</span>,</span>
<span>                <span class="st">"Treponema_denticola"</span>, <span class="st">"Aggregatibacter_actinomycetemcomitans"</span><span class="op">)</span>,</span>
<span>  scfa_producers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Faecalibacterium_prausnitzii"</span>, <span class="st">"Roseburia_intestinalis"</span>,</span>
<span>                     <span class="st">"Eubacterium_rectale"</span>, <span class="st">"Coprococcus_catus"</span>,</span>
<span>                     <span class="st">"Butyricicoccus_pullicaecorum"</span>, <span class="st">"Anaerostipes_caccae"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssTaxSEA.html">ssTaxSEA</a></span><span class="op">(</span><span class="va">counts</span>, custom_db <span class="op">=</span> <span class="va">my_sets</span>, min_set_size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="interpreting-the-output">Interpreting the output<a class="anchor" aria-label="anchor" href="#interpreting-the-output"></a>
</h2>
<p><strong>Scores.</strong> A positive enrichment score for a given
sample and taxon set means that the taxa in that set tend to have higher
abundance in that sample relative to the rest of the cohort. A negative
score means they tend to be lower. The magnitude reflects how strong and
coordinated the shift is.</p>
<p><strong>P-values.</strong> The KS test p-value tells you whether the
distribution of z-scores for set members differs from the background in
that sample. Note that these are unadjusted p-values. Since you are
testing many sets across many samples, apply your own multiple testing
correction as appropriate for your analysis.</p>
</div>
<div class="section level2">
<h2 id="practical-considerations">Practical considerations<a class="anchor" aria-label="anchor" href="#practical-considerations"></a>
</h2>
<p><strong>Cohort composition matters.</strong> Because z-scoring is
relative to the cohort mean, the composition of your cohort affects the
scores. If your cohort is 90% disease samples, the “average” will look
disease-like and scores will be less extreme. A balanced cohort (or at
least a well-defined reference group) generally gives more interpretable
results.</p>
<p><strong>Sample size.</strong> Z-scoring requires a reasonable number
of samples to estimate the mean and standard deviation for each taxon.
With very few samples (fewer than ~10), estimates will be noisy.</p>
<p><strong>BugSigDB is excluded.</strong> <code>ssTaxSEA</code> uses the
built-in TaxSEA database (GMRepoV2, MiMeDB, gutMGene, mBodyMap, BacDive)
but does not load BugSigDB. This keeps the function fast and avoids the
need for the <code>bugsigdbr</code> dependency.</p>
<p><strong>Downstream analysis.</strong> The score matrix is designed to
slot into standard statistical workflows. You can use it for:</p>
<ul>
<li>Heatmaps to visualise per-sample enrichment patterns</li>
<li>Correlation with clinical metadata</li>
<li>Group comparisons (e.g. Wilcoxon test on scores between disease and
control)</li>
<li>Clustering or ordination to identify patient subgroups</li>
<li>Survival analysis or regression using scores as predictors</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Feargal Ryan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
